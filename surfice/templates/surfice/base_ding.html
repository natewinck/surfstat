{% extends "surfice/base.html" %}

{% block title %}Admin | Ding from {{ ding.email }}{% endblock %}

{% load static %}
{% load humanize %}
{% load slugify %}
{% load nav %}

{% block css %}
<!-- x-editable (bootstrap version) -->
<link href="{% static 'surfice/css/bootstrap-editable.css' %}" rel="stylesheet">
<link href="{% static 'surfice/css/bootstrap-datetimepicker.min.css' %}" rel="stylesheet" type="text/css"></link> 
{% endblock %}

{% block body_class %}admin{% endblock %}


{% block nav %}
	{% nav "dings" %}
	{% include "surfice/admin_nav.html" %}
{% endblock %}


{% block heading %}
<div class="container">
	<div class="jumbotron jumbotron-admin">
		<h1>What's up {{ ding.surfice.name }}?</h1>

		<div class="container">
			<p>{{ ding.surfice.description }}</p>
		</div>
	</div>
</div>
{% endblock heading %}

{% block content %}
<div class="container">
	
	<div class="page-header">
		<h2><a href="mailto:{{ ding.email }}">{{ ding.email }}</a> sent in this Ding</h2>
	</div>
	
	<!-- left info -->
	<div class="col-sm-4">
		<div class="row">
			<div class="col-xs-12">
				<h4>Surfice</h4>
				<p>{{ ding.surfice.name }}</p>
			</div>
		</div>
		
		<div class="row dynamic-color" style="background-color:{{ ding.surfice.status.data.color }}">
			<div class="col-xs-12">
				<h4>Current Surfice Status</h4>
				<p data-ajax-update="surfice-status">{{ ding.surfice.status.name }}</p>
			</div>
		</div>
		
		<div class="row">
			<div class="col-xs-12">
				<h4>Reports Today</h4>
				<p>{{ surfice_dings }}</p>
			</div>
		</div>
		
		<hr>
		
		<!-- update surfice status -->
		<div class="row">
			<div class="col-xs-12">
				<h4>Quick Update Status</h4>
				<form type="ajax" action="ajax/set-status" method="post" role="form"
					data-ajax-action="ajax/get-surfice"
					data-ajax-get='{ "surfice": {{ ding.surfice.id }} }'
					data-ajax-update-target="surfice-status"
				>
					{# To prevent cross-site forgery, include the following required tag #}
					{% csrf_token %}
					<input type="hidden" name="surfice" value="{{ ding.surfice.id }}">
					<div class="form-group">
						<label class="control-label">Select Status</label>
						<select name="status" class="form-control">
							{% for status in statuses %}
							<option value="{{ status.id }}" {% if status == ding.surfice.status %}selected="selected"{% endif %}>{{ status.name }}</option>
							{% endfor %}
						</select>
					</div>
					<div class="form-group">
						<label class="control-label">Status Description</label>
						<textarea name="description" class="form-control" rows="3" placeholder="(Optional) Add your status description..."
							data-ajax-clear></textarea>
					</div>
					<div class="row">
						<div class="col-xs-offset-10 col-xs-2">
							<button type="submit" class="btn btn-success button-accordian pull-right">Submit</button>
						</div>
					</div>
				</form>
			</div>
		</div>
		<!-- /end update surfice status -->
		
	</div>
	<!-- /end left info -->
	
	<!-- ding info -->
	<div class="col-sm-8">
		<div class="dynamic-color well well-sm" style="background-color:{{ ding.status.data.color }}">Reported status: {{ ding.status.name }}</div>
		{# Make sure description isn't empty #}
		{% if ding.description and ding.description.strip %}
		<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">Description of Ding from {{ ding.email }}</h3>
			</div>
			<div class="panel-body">
				<p>{{ ding.description }}</p>
			</div>
		</div>
		
		{% else %}
		<h3><a href="mailto:{{ ding.email }}">{{ ding.email }}</a> did not provide a description</h3>
		{% endif %}
		
		<div class="panel panel-info">
			<div class="panel-heading">
				<h3 class="panel-title">User Metadata</h3>
			</div>
			<div class="panel-body">
				<h4>Network</h4>
				<p>	{% if ding.data.hostname != '' %}
					Hostname: {{ ding.data.hostname }}<br>
					{% else %}
					<em>No hostname</em><br>
					{% endif %}
					
					IP Address: {{ ding.data.ip }}
				
				<h4>Browser</h4>
				<p>	Family: {{ ding.data.browser.family }}<br>
					Version: {{ ding.data.browser.version_string }}<br>
					
				</p>
				
				<h4>Device</h4>
				<p>	Family: {{ ding.data.device.family }}<br>
					OS: {{ ding.data.os.family }} {{ ding.data.os.version_string }}<br>
				<p>
			</div>
		</div>
		
		<span class="glyphicon glyphicon-envelope"></span> <a href="mailto:{{ ding.email }}">Reply</a>
		<span class="glyphicon glyphicon-remove text-danger"></span>
			<a class="text-danger" href="#"
				data-toggle="modal"
				data-target="#confirm-delete-ding-{{ ding.id }}"
			>Delete</a>
	</div>
	<!-- /end ding info -->
	
</div>
<hr class="featurette-divider">

<!-- delete ding modal -->
<div class="modal fade" id="confirm-delete-ding-{{ ding.id }}" tabindex="-1" role="dialog" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">Confirm Delete</h4>
			</div>
			<div class="modal-body">
				Are you sure you want to delete this ding?
			</div>
			<div class="modal-footer">
				<form action="" method="post">
					{# To prding cross-site forgery, include the following required tag #}
					{% csrf_token %}
					<input type="hidden" name="ding" value="{{ ding.id }}">
					<input type="hidden" name="delete" value="1">
					<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
					<button type="submit" href="#" class="btn btn-danger danger">Delete</button>
				</form>
			</div>
		</div>
	</div>
</div>
<!-- /end delete ding modal -->

{% endblock content %}

{% block scripts %}
<script src="{% static 'surfice/js/moment.min.js' %}"></script>

{% endblock %}